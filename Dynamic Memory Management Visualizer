<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Memory Management Visualizer</title>

  <!-- Google Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      /* default (dark) theme values */
      --bg-page: radial-gradient(circle at top, rgba(15,23,42,0.9) 0, #020617 45%, #020617 100%);
      --bg-img: url("https://images.unsplash.com/photo-1498050108023-c5249f4df085?auto=format&fit=crop&w=1600&q=80");

      --glass-bg: rgba(15, 23, 42, 0.72);
      --glass-border: rgba(148, 163, 184, 0.55);
      --glass-highlight: rgba(56, 189, 248, 0.35);

      --text-main: #e5e7eb;
      --text-muted: #9ca3af;

      --accent: #22c55e;
      --accent-soft: rgba(34, 197, 94, 0.14);

      --hit: #4ade80;
      --fault: #fb923c;
      --danger: #f97373;

      --frame-border: rgba(148, 163, 184, 0.72);
      --frame-bg-1: rgba(15, 23, 42, 0.98);
      --frame-bg-2: rgba(30, 64, 175, 0.35);

      --chip-bg: rgba(15, 23, 42, 0.85);
      --log-bg: rgba(15, 23, 42, 0.96);

      --shadow-strong: 0 26px 60px rgba(15, 23, 42, 0.9);
      --shadow-soft: 0 16px 36px rgba(15, 23, 42, 0.75);
    }

    body.theme-light {
      --bg-page: radial-gradient(circle at top, #e0f2fe 0, #f3f4f6 50%, #e5e7eb 100%);
      --bg-img: url("https://images.unsplash.com/photo-1531297484001-80022131f5a1?auto=format&fit=crop&w=1600&q=80");

      --glass-bg: rgba(255, 255, 255, 0.78);
      --glass-border: rgba(148, 163, 184, 0.6);
      --glass-highlight: rgba(59, 130, 246, 0.16);

      --text-main: #0f172a;
      --text-muted: #6b7280;

      --accent: #16a34a;
      --accent-soft: rgba(22, 163, 74, 0.12);

      --hit: #16a34a;
      --fault: #ea580c;
      --danger: #dc2626;

      --frame-border: rgba(148, 163, 184, 0.85);
      --frame-bg-1: rgba(248, 250, 252, 0.92);
      --frame-bg-2: rgba(191, 219, 254, 0.7);

      --chip-bg: rgba(255, 255, 255, 0.85);
      --log-bg: rgba(241, 245, 249, 0.96);

      --shadow-strong: 0 24px 60px rgba(15, 23, 42, 0.28);
      --shadow-soft: 0 14px 30px rgba(15, 23, 42, 0.18);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--text-main);
      min-height: 100vh;
      background-image:
        linear-gradient(to bottom, rgba(15,23,42,0.9), rgba(15,23,42,0.65)),
        var(--bg-img),
        var(--bg-page);
      background-size: cover;
      background-attachment: fixed;
      background-position: center;
    }

    .backdrop-overlay {
      min-height: 100vh;
      backdrop-filter: blur(12px);
      padding-bottom: 40px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 26px 18px 40px;
    }

    /* Header */

    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 16px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .title-wrap {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .title-top-row {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .title-main {
      font-size: 24px;
      font-weight: 700;
      letter-spacing: 0.02em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .title-accent {
      width: 9px;
      height: 28px;
      border-radius: 999px;
      background: linear-gradient(180deg, #22c55e, #4ade80);
      box-shadow: 0 0 18px rgba(34, 197, 94, 0.9);
    }

    .subtitle {
      font-size: 13px;
      color: var(--text-muted);
      max-width: 580px;
    }

    .dev-badge {
      padding: 7px 14px;
      border-radius: 999px;
      border: 1px solid var(--glass-border);
      background: var(--chip-bg);
      box-shadow: var(--shadow-soft);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: var(--text-muted);
    }

    .dev-avatar {
      width: 24px;
      height: 24px;
      border-radius: 999px;
      background: linear-gradient(135deg, #22c55e, #0ea5e9);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      color: white;
      font-weight: 600;
      box-shadow: 0 0 0 3px rgba(15, 23, 42, 0.7);
    }

    .dev-badge span.name {
      font-weight: 600;
      color: var(--text-main);
    }

    .dev-badge small {
      font-size: 11px;
      color: var(--text-muted);
    }

    .header-right {
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: flex-end;
    }

    .theme-toggle {
      padding: 6px 11px;
      border-radius: 999px;
      border: 1px solid var(--glass-border);
      background: var(--chip-bg);
      display: inline-flex;
      align-items: center;
      gap: 7px;
      cursor: pointer;
      font-size: 12px;
      color: var(--text-muted);
      box-shadow: var(--shadow-soft);
      transition: transform 120ms ease, box-shadow 140ms ease, border 140ms ease;
    }

    .theme-toggle:hover {
      transform: translateY(-1px);
      box-shadow: 0 18px 40px rgba(15, 23, 42, 0.45);
      border-color: var(--glass-highlight);
    }

    .theme-toggle span.icon {
      width: 20px;
      height: 20px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      background: linear-gradient(135deg, rgba(250, 204, 21, 0.15), rgba(56, 189, 248, 0.18));
    }

    /* Glass cards */

    .card {
      position: relative;
      border-radius: 20px;
      background:
        radial-gradient(circle at top left, var(--glass-highlight), transparent 55%),
        var(--glass-bg);
      border: 1px solid var(--glass-border);
      padding: 18px 18px 20px;
      margin-bottom: 18px;
      box-shadow: var(--shadow-strong);
      overflow: hidden;
      backdrop-filter: blur(18px);
    }

    .card::before {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      background: linear-gradient(135deg, rgba(255,255,255,0.07), transparent 70%);
      mix-blend-mode: soft-light;
    }

    .card-inner {
      position: relative;
      z-index: 1;
    }

    /* Controls layout */

    .controls {
      display: grid;
      grid-template-columns: minmax(260px, 2.1fr) repeat(3, minmax(140px, 1.05fr)) 200px;
      gap: 14px;
      align-items: stretch;
    }

    @media (max-width: 1100px) {
      .controls {
        grid-template-columns: minmax(260px, 2fr) repeat(2, 1fr);
      }
    }

    @media (max-width: 780px) {
      .controls {
        grid-template-columns: 1fr;
      }
    }

    .form-group {
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    label {
      font-size: 11px;
      font-weight: 500;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.15em;
    }

    textarea,
    input,
    select {
      margin-top: 6px;
      padding: 8px 11px;
      border-radius: 12px;
      border: 1px solid var(--glass-border);
      background: rgba(15, 23, 42, 0.85);
      color: var(--text-main);
      font-size: 13px;
outline: none;
      width: 100%;
      transition: border 130ms ease, box-shadow 130ms ease, background 130ms ease, transform 120ms ease;
    }

    body.theme-light textarea,
    body.theme-light input,
    body.theme-light select {
      background: rgba(255,255,255,0.9);
    }

    textarea {
      resize: vertical;
      min-height: 80px;
      max-height: 140px;
    }

    textarea:focus,
    input:focus,
    select:focus {
      border-color: rgba(34, 197, 94, 0.85);
      box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.4);
      background: rgba(15,23,42,0.95);
      transform: translateY(-1px);
    }

    body.theme-light textarea:focus,
    body.theme-light input:focus,
    body.theme-light select:focus {
      background: #f9fafb;
    }

    select {
      cursor: pointer;
      appearance: none;
      background-image:
        linear-gradient(45deg, transparent 50%, #9ca3af 50%),
        linear-gradient(135deg, #9ca3af 50%, transparent 50%);
      background-position:
        calc(100% - 14px) calc(50% - 3px),
        calc(100% - 9px) calc(50% - 3px);
      background-size: 6px 6px, 6px 6px;
      background-repeat: no-repeat;
    }

    /* Buttons */

    button {
      padding: 9px 14px;
      border-radius: 999px;
      border: 0;
      cursor: pointer;
      font-size: 13px;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background 140ms ease, transform 120ms ease, box-shadow 140ms ease, border 140ms ease;
      white-space: nowrap;
    }

    button.primary {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: white;
      box-shadow: 0 16px 36px rgba(16, 185, 129, 0.5);
    }

    button.primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 22px 50px rgba(16, 185, 129, 0.7);
    }

    button.primary:active {
      transform: translateY(0);
      box-shadow: 0 10px 28px rgba(16, 185, 129, 0.55);
    }

    button.ghost {
      background: var(--chip-bg);
      border: 1px solid var(--glass-border);
      color: var(--text-muted);
    }

    button.ghost:hover {
      border-color: var(--glass-highlight);
      transform: translateY(-1px);
      box-shadow: var(--shadow-soft);
    }

    .btn-group-col {
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      gap: 8px;
      height: 100%;
    }

    .btn-row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    /* Speed slider */

    .speed-wrap {
      display: flex;
      flex-direction: column;
      height: 100%;
      justify-content: flex-end;
    }

    input[type="range"] {
      margin-top: 8px;
      appearance: none;
      height: 5px;
      border-radius: 999px;
      background: linear-gradient(90deg, #0ea5e9, #22c55e);
      border: none;
    }

    input[type="range"]::-webkit-slider-thumb {
      appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #e5e7eb;
      border: 2px solid #0f172a;
      box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.3);
      cursor: pointer;
      transition: box-shadow 120ms ease, transform 120ms ease;
    }

    input[type="range"]:hover::-webkit-slider-thumb {
      box-shadow: 0 0 0 7px rgba(34, 197, 94, 0.5);
      transform: scale(1.05);
    }

    #speedVal {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 5px;
      text-align: right;
    }

    /* Summary bar */

    .summary-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }

    .summary-chip {
      padding: 7px 12px;
      border-radius: 999px;
      border: 1px solid var(--glass-border);
      font-size: 12px;
      background: var(--chip-bg);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: var(--text-muted);
    }

    .summary-chip strong {
      color: var(--text-main);
      font-weight: 600;
    }

    .summary-chip.badge {
      border-color: rgba(59,130,246,0.8);
      background:
        radial-gradient(circle at top left, rgba(59, 130, 246, 0.3), transparent 55%),
        var(--chip-bg);
    }

    /* Frames */

    .frames {
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
      margin-top: 16px;
    }

    .frame {
      width: 120px;
      height: 86px;
      border-radius: 18px;
      border: 1px solid var(--frame-border);
      background:
        radial-gradient(circle at top left, var(--frame-bg-2), transparent 55%),
        var(--frame-bg-1);
      color: var(--text-main);
      font-size: 30px;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
      box-shadow: var(--shadow-soft);
      transition: border 150ms ease, transform 140ms ease, box-shadow 150ms ease;
    }

    .frame::after {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(150deg, rgba(255,255,255,0.16), transparent 50%);
      mix-blend-mode: soft-light;
      pointer-events: none;
    }

    .frame span.label {
      position: absolute;
      bottom: 8px;
      left: 10px;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-weight: 500;
      color: var(--text-muted);
    }

    .frame.active {
      border-color: rgba(248, 113, 113, 0.98);
      box-shadow: 0 24px 60px rgba(248, 113, 113, 0.6);
      transform: translateY(-3px);
      animation: pulseFrame 480ms ease-out;
    }

    @keyframes pulseFrame {
      0% { transform: translateY(0) scale(1); }
      45% { transform: translateY(-4px) scale(1.04); }
      100% { transform: translateY(-3px) scale(1); }
    }

    /* Section header */

    .section-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 20px;
      margin-bottom: 6px;
    }

    .section-title {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--text-muted);
    }

    .section-line {
      flex: 1;
      height: 1px;
      background: linear-gradient(to right, rgba(148, 163, 184, 0.65), transparent);
      opacity: 0.8;
    }

    /* Reference stream */

    .stream {
      display: flex;
      flex-wrap: wrap;
      gap: 7px;
      margin-top: 10px;
    }

    .refItem {
      padding: 6px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.55);
      background: var(--chip-bg);
      font-size: 12px;
      color: var(--text-muted);
      min-width: 30px;
      text-align: center;
      transition: background 150ms ease, border 150ms ease, transform 120ms ease, color 150ms ease, box-shadow 150ms ease;
    }

    .refItem.current {
      background: var(--accent-soft);
      border-color: rgba(34, 197, 94, 0.95);
      color: #bbf7d0;
      box-shadow: 0 18px 42px rgba(34, 197, 94, 0.6);
      transform: translateY(-1px);
    }

    /* Stats */

    .stats {
      display: grid;
      grid-template-columns: repeat(3, minmax(140px, 1fr));
      gap: 12px;
      margin-top: 18px;
    }

    @media (max-width: 820px) {
      .stats {
        grid-template-columns: 1fr;
      }
    }

    .stat-card {
      border-radius: 18px;
      padding: 10px 13px 11px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      background:
        radial-gradient(circle at top left, rgba(148, 163, 184, 0.18), transparent 60%),
        var(--chip-bg);
      box-shadow: var(--shadow-soft);
      font-size: 12px;
      color: var(--text-muted);
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .stat-label {
      text-transform: uppercase;
      letter-spacing: 0.18em;
      font-weight: 500;
      font-size: 10px;
      color: var(--text-muted);
    }

    .stat-value-row {
      display: flex;
      align-items: baseline;
      gap: 6px;
    }

    .stat-value {
      font-size: 22px;
      font-weight: 600;
      color: var(--text-main);
    }

    .stat-suffix {
      font-size: 11px;
      color: var(--text-muted);
    }

    .stat-pill {
      margin-top: 4px;
      align-self: flex-start;
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 10px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: var(--chip-bg);
    }

    .stat-pill.hit {
      border-color: rgba(34, 197, 94, 0.7);
      color: #bbf7d0;
      background: rgba(22, 163, 74, 0.2);
    }

    .stat-pill.fault {
      border-color: rgba(248, 113, 113, 0.82);
      color: #fecaca;
      background: rgba(185, 28, 28, 0.22);
    }

    .stat-pill.ratio {
      border-color: rgba(59, 130, 246, 0.85);
      color: #bfdbfe;
      background: rgba(37, 99, 235, 0.24);
    }

    /* Log */

    .log {
      margin-top: 20px;
      border-radius: 16px;
      background: var(--log-bg);
      border: 1px solid rgba(30, 64, 175, 0.9);
      box-shadow: var(--shadow-soft);
      max-height: 240px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .log-header {
      padding: 8px 11px 7px;
      border-bottom: 1px solid rgba(30, 64, 175, 0.95);
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
color: var(--text-muted);
    }

    .log-header span.label {
      text-transform: uppercase;
      letter-spacing: 0.16em;
      font-weight: 500;
    }

    .log-badge {
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 10px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: var(--chip-bg);
      color: var(--text-muted);
    }

    #logArea {
      max-height: 200px;
      overflow-y: auto;
    }

    .logItem {
      padding: 7px 11px;
      border-bottom: 1px solid rgba(15, 23, 42, 0.9);
      font-size: 12px;
      color: var(--text-muted);
    }

    .logItem:last-child {
      border-bottom: none;
    }

    .logItem strong {
      color: var(--text-main);
      font-weight: 600;
    }

    .hit-tag {
      color: var(--hit);
      font-weight: 600;
    }

    .fault-tag {
      color: var(--fault);
      font-weight: 600;
    }

    .replace-tag {
      color: var(--danger);
      font-weight: 600;
    }

    /* Scrollbars */

    ::-webkit-scrollbar {
      width: 8px;
    }
    ::-webkit-scrollbar-track {
      background: rgba(15,23,42,0.9);
    }
    ::-webkit-scrollbar-thumb {
      background: #1f2937;
      border-radius: 999px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #374151;
    }

    body.theme-light ::-webkit-scrollbar-track {
      background: #e5e7eb;
    }
    body.theme-light ::-webkit-scrollbar-thumb {
      background: #94a3b8;
    }
  </style>
</head>
<body class="theme-dark">
  <div class="backdrop-overlay">
    <div class="container">
      <header class="page-header">
        <div class="title-wrap">
          <div class="title-top-row">
            <div class="title-main">
              <span class="title-accent"></span>
              Memory Management Visualizer
            </div>
          </div>
          <div class="subtitle">
            Simulate page replacement step by step and visualize how frames change for FIFO and LRU algorithms.
          </div>
        </div>

        <div class="header-right">
          <div class="dev-badge">
            <div class="dev-avatar">M</div>
            <div>
              <span class="name">Developed by Mayank,Yash,Nandan</span><br />
              <small>University Presentation ¬∑ OS / Memory Management</small>
            </div>
          </div>
          <button id="themeToggle" class="theme-toggle">
            <span class="icon" id="themeIcon">üåô</span>
            <span id="themeLabel">Dark mode</span>
          </button>
        </div>
      </header>

      <!-- Controls card -->
      <section class="card">
        <div class="card-inner">
          <div class="controls">
            <div class="form-group">
              <label>Reference string</label>
              <textarea id="refInput">1 2 3 4 1 2 5 1 2 3 4 5</textarea>
            </div>

            <div class="form-group">
              <label>Frames</label>
              <input id="framesInput" type="number" min="1" value="4">
            </div>

            <div class="form-group">
              <label>Algorithm</label>
              <select id="algoSelect">
                <option>FIFO</option>
                <option>LRU</option>
              </select>
            </div>

            <div class="btn-group-col">
              <div class="btn-row">
                <button id="applyBtn" class="primary">Apply</button>
                <button id="resetBtn" class="ghost">Reset</button>
              </div>
              <div class="btn-row">
                <button id="playBtn" class="primary">Play</button>
                <button id="stepBtn" class="ghost">Step</button>
              </div>
            </div>

            <div class="speed-wrap">
              <label>Speed (ms)</label>
              <input id="speed" type="range" min="100" max="1500" value="700">
              <div id="speedVal">700 ms</div>
            </div>
          </div>
        </div>
      </section>
<section class="card">
        <div class="card-inner">
          <div class="summary-bar">
            <div class="summary-chip">
              Frames: <strong id="framesCount">4</strong>
            </div>
            <div class="summary-chip">
              Algorithm: <strong id="algoName">FIFO</strong>
            </div>
            <div class="summary-chip badge">
              Step: <strong id="stepInfo">0 / 0</strong>
            </div>
          </div>

          <div class="frames" id="framesArea"></div>

          <div class="section-header">
            <span class="section-title">Reference Stream</span>
            <div class="section-line"></div>
          </div>
          <div id="streamArea" class="stream"></div>

          <div class="stats">
            <div class="stat-card">
              <div class="stat-label">Hits</div>
              <div class="stat-value-row">
                <div class="stat-value" id="hits">0</div>
                <div class="stat-suffix">pages</div>
              </div>
              <div class="stat-pill hit">Page already present in frame</div>
            </div>

            <div class="stat-card">
              <div class="stat-label">Faults</div>
              <div class="stat-value-row">
                <div class="stat-value" id="faults">0</div>
                <div class="stat-suffix">page faults</div>
              </div>
              <div class="stat-pill fault">New page loaded or replaced</div>
            </div>

            <div class="stat-card">
              <div class="stat-label">Hit Ratio</div>
              <div class="stat-value-row">
                <div class="stat-value" id="hitRatio">0</div>
                <div class="stat-suffix">hits / access</div>
              </div>
              <div class="stat-pill ratio">Overall efficiency of memory usage</div>
            </div>
          </div>

          <div class="section-header" style="margin-top: 22px;">
            <span class="section-title">Event Log</span>
            <div class="section-line"></div>
          </div>
<div class="log">
            <div class="log-header">
              <span class="label">Most recent operations</span>
              <div class="log-badge">Access ¬∑ Hit / Fault ¬∑ Frame action</div>
            </div>
            <div id="logArea"></div>
          </div>
        </div>
      </section>
    </div>
  </div>

  <script>
    (function () {
      const refInput = document.getElementById("refInput");
      const framesInput = document.getElementById("framesInput");
      const algoSelect = document.getElementById("algoSelect");
      const applyBtn = document.getElementById("applyBtn");
      const resetBtn = document.getElementById("resetBtn");
      const playBtn = document.getElementById("playBtn");
      const stepBtn = document.getElementById("stepBtn");
      const framesArea = document.getElementById("framesArea");
      const streamArea = document.getElementById("streamArea");
      const logArea = document.getElementById("logArea");
      const framesCountEl = document.getElementById("framesCount");
      const algoNameEl = document.getElementById("algoName");
      const stepInfo = document.getElementById("stepInfo");
      const hitsEl = document.getElementById("hits");
      const faultsEl = document.getElementById("faults");
      const hitRatioEl = document.getElementById("hitRatio");
      const speedEl = document.getElementById("speed");
      const speedVal = document.getElementById("speedVal");

      const themeToggle = document.getElementById("themeToggle");
      const themeIcon = document.getElementById("themeIcon");
      const themeLabel = document.getElementById("themeLabel");

      let refs = [];
      let frames = [];
      let fifoQueue = [];
      let lruMap = new Map();
      let history = [];
      let index = 0;
      let playing = false;
      let timer = null;

      function parseRefs(text) {
        return text
          .trim()
          .split(/[\s,]+/)
          .map((s) => parseInt(s))
          .filter((n) => !isNaN(n));
      }

      function renderFrames() {
        framesArea.innerHTML = "";
        frames.forEach((f, i) => {
          const div = document.createElement("div");
          const latest = history.length ? history[history.length - 1] : null;
          div.className = "frame" + (latest && latest.frame === i ? " active" : "");
          div.textContent = f.page === null ? "‚Äî" : f.page;
          const label = document.createElement("span");
          label.textContent = "Frame " + i;
          label.className = "label";
          div.appendChild(label);
          framesArea.appendChild(div);
        });
      }

      function renderStream() {
        streamArea.innerHTML = "";
        refs.forEach((r, i) => {
          const s = document.createElement("div");
          s.className = "refItem" + (i === index ? " current" : "");
          s.textContent = r;
          streamArea.appendChild(s);
        });
      }

      function addLog(msg) {
        const el = document.createElement("div");
        el.className = "logItem";
        el.innerHTML = msg;
        logArea.insertBefore(el, logArea.firstChild);
      }

      function updateStats() {
        const hits = history.filter((h) => h.result === "hit").length;
        const faults = history.filter((h) => h.result !== "hit").length;
        const total = history.length;
        hitsEl.textContent = hits;
        faultsEl.textContent = faults;
        hitRatioEl.textContent = total ? (hits / total).toFixed(2) : "0";
        stepInfo.textContent = `${index} / ${refs.length}`;
      }
function resetSimulation() {
        const fcount = Math.max(1, parseInt(framesInput.value) || 4);
        frames = Array.from({ length: fcount }, () => ({ page: null }));
        fifoQueue = [];
        lruMap = new Map();
        history = [];
        index = 0;
        playing = false;
        clearInterval(timer);
        renderFrames();
        renderStream();
        logArea.innerHTML = "";
        updateStats();
        framesCountEl.textContent = fcount;
        algoNameEl.textContent = algoSelect.value;
        playBtn.textContent = "Play";
      }

      function accessPage(page) {
        const hitFrameIndex = frames.findIndex((fr) => fr.page === page);
        if (hitFrameIndex !== -1) {
          lruMap.delete(page);
          lruMap.set(page, Date.now());
          const ev = {
            page,
            result: "hit",
            frame: hitFrameIndex,
            snapshot: JSON.parse(JSON.stringify(frames)),
          };
          history.push(ev);
          addLog(
            `Access <strong>${page}</strong> ‚Äî ` +
              `<span class="hit-tag">HIT</span> ` +
              `(frame ${hitFrameIndex})`
          );
          return ev;
        }

        const freeIndex = frames.findIndex((fr) => fr.page === null);
        if (freeIndex !== -1) {
          frames[freeIndex].page = page;
          fifoQueue.push(freeIndex);
          lruMap.set(page, Date.now());
          const ev = {
            page,
            result: "page_fault_alloc",
            frame: freeIndex,
            snapshot: JSON.parse(JSON.stringify(frames)),
          };
          history.push(ev);
          addLog(
            `Access <strong>${page}</strong> ‚Äî ` +
              `<span class="fault-tag">PAGE FAULT</span> ` +
              `(allocated frame ${freeIndex})`
          );
          return ev;
        }

        let evictedIdx = 0;
        if (algoSelect.value === "FIFO") {
          evictedIdx = fifoQueue.shift();
          fifoQueue.push(evictedIdx);
        } else {
          const entries = Array.from(lruMap.entries());
          if (entries.length) {
            entries.sort((a, b) => a[1] - b[1]);
            const evictedPage = entries[0][0];
            evictedIdx = frames.findIndex((f) => f.page === evictedPage);
          } else {
            evictedIdx = 0;
          }
        }

        const evictedPage = frames[evictedIdx].page;
        frames[evictedIdx].page = page;
        lruMap.delete(evictedPage);
        lruMap.set(page, Date.now());
        const ev = {
          page,
          result: "page_fault_replace",
          frame: evictedIdx,
          evicted: { page: evictedPage, frame: evictedIdx },
          snapshot: JSON.parse(JSON.stringify(frames)),
        };
        history.push(ev);
        addLog(
          `Access <strong>${page}</strong> ‚Äî ` +
            `<span class="replace-tag">PAGE FAULT (replace)</span> ` +
            `evicted <strong>${evictedPage}</strong> from frame ${evictedIdx}`
        );
        return ev;
      }

      function step() {
        if (index >= refs.length) {
          playing = false;
          clearInterval(timer);
          playBtn.textContent = "Play";
          return;
        }
        const p = refs[index];
        accessPage(p);
        index++;
        renderFrames();
        renderStream();
        updateStats();
      }

      // Event handlers
      applyBtn.addEventListener("click", () => {
        refs = parseRefs(refInput.value);
        resetSimulation();
      });

      resetBtn.addEventListener("click", () => resetSimulation());

      stepBtn.addEventListener("click", () => {
        playing = false;
        clearInterval(timer);
        playBtn.textContent = "Play";
        step();
      });

      playBtn.addEventListener("click", () => {
        if (playing) {
          playing = false;
          clearInterval(timer);
          playBtn.textContent = "Play";
          return;
        }
        playing = true;
        playBtn.textContent = "Pause";
        const ms = Math.max(50, parseInt(speedEl.value) || 700);
        timer = setInterval(() => {
          if (index >= refs.length) {
            clearInterval(timer);
            playing = false;
            playBtn.textContent = "Play";
            return;
          }
          step();
        }, ms);
      });

      speedEl.addEventListener("input", () => {
        speedVal.textContent = speedEl.value + " ms";
      });

      // Theme toggle
      themeToggle.addEventListener("click", () => {
        const body = document.body;
        const isDark = body.classList.contains("theme-dark");
        if (isDark) {
          body.classList.remove("theme-dark");
          body.classList.add("theme-light");
          themeIcon.textContent = "‚òÄÔ∏è";
          themeLabel.textContent = "Light mode";
        } else {
          body.classList.remove("theme-light");
          body.classList.add("theme-dark");
          themeIcon.textContent = "üåô";
          themeLabel.textContent = "Dark mode";
        }
      });

      // Initial setup
      refs = parseRefs(refInput.value);
      resetSimulation();
    })();
  </script>
</body>
</html>
